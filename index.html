<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VLESS Config Fixer</title>
    <style>
        :root { --p: #4f46e5; --bg: #f1f5f9; }
        body { font-family: tahoma; background: var(--bg); display: flex; justify-content: center; padding: 20px; }
        .card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        h2 { color: var(--p); margin-bottom: 20px; }
        input { width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--p); color: white; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        button:hover { background: #4338ca; }
        #status { margin-top: 15px; padding: 10px; display: none; border-radius: 8px; font-size: 14px; }
        .success { background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; }
        .download-btn { background: #22c55e; text-decoration: none; display: block; color: white; padding: 12px; border-radius: 8px; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <h2>ÙˆÛŒØ±Ø§ÛŒØ´Ú¯Ø± Ú©Ø§Ù†ÙÛŒÚ¯ VLESS</h2>
    
    <label>Ø§Ù†ØªØ®Ø§Ø¨ ÙØ§ÛŒÙ„ (vl.txt):</label>
    <input type="file" id="fileInput" accept=".txt">
    
    <input type="text" id="newIp" placeholder="Ø¢ÛŒâ€ŒÙ¾ÛŒ Ø¬Ø¯ÛŒØ¯ (Ù…Ø«Ù„Ø§ 8.6.112.0)" value="8.6.112.0">
    <input type="text" id="newName" placeholder="Ù†Ø§Ù… Ø¯Ù„Ø®ÙˆØ§Ù‡ (Ù…Ø«Ù„Ø§ Shatak-New)">
    <input type="text" id="flag" placeholder="Ù¾Ø±Ú†Ù… (ğŸ‡ºğŸ‡¸)" value="ğŸ‡ºğŸ‡¸">

    <button onclick="processFile()">ğŸš€ Ù¾Ø±Ø¯Ø§Ø²Ø´ Ùˆ Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„ Ø¬Ø¯ÛŒØ¯</button>

    <div id="status"></div>
    <div id="dlContainer"></div>
</div>

<script>
    function processFile() {
        const fileInput = document.getElementById('fileInput');
        const newIp = document.getElementById('newIp').value.trim();
        const newName = document.getElementById('newName').value.trim() || "Config";
        const flag = document.getElementById('flag').value.trim();
        const status = document.getElementById('status');
        const dlContainer = document.getElementById('dlContainer');

        if (!fileInput.files[0]) {
            alert("Ù„Ø·ÙØ§Ù‹ ÙØ§ÛŒÙ„ Ø±Ø§ Ø§Ù†ØªØ®Ø§Ø¨ Ú©Ù†ÛŒØ¯");
            return;
        }

        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            const lines = content.split(/\r?\n/);
            let results = [];
            let count = 0;

            lines.forEach((line) => {
                if (line.includes('vless://') && line.includes('type=ws')) {
                    try {
                        // Ù¾ÛŒØ¯Ø§ Ú©Ø±Ø¯Ù† Ø´Ø±ÙˆØ¹ Ù„ÛŒÙ†Ú© Ø§ØµÙ„ÛŒ
                        let startIndex = line.indexOf('vless://');
                        let config = line.substring(startIndex);

                        // ØªÙÚ©ÛŒÚ© Ø¨Ø®Ø´â€ŒÙ‡Ø§
                        let [mainPart, remarkPart] = config.split('#');
                        let [uuidPart, rest] = mainPart.split('@');
                        let [addressPart, paramsPart] = rest.split('?');

                        // ØªØºÛŒÛŒØ± Ø¢ÛŒâ€ŒÙ¾ÛŒ Ùˆ Ù¾ÙˆØ±Øª
                        let newAddress = `${newIp}:443`;
                        
                        // Ø³Ø§Ø®Øª Ù†Ø§Ù… Ø¬Ø¯ÛŒØ¯
                        count++;
                        let finalRemark = `${newName} ${count} ${flag}`;

                        // Ø³Ø±Ù‡Ù… Ú©Ø±Ø¯Ù† Ù…Ø¬Ø¯Ø¯
                        let newLine = `${uuidPart}@${newAddress}?${paramsPart}#${encodeURIComponent(finalRemark)}`;
                        results.push(newLine);
                    } catch (err) {
                        console.error("Error parsing line:", err);
                    }
                }
            });

            if (results.length > 0) {
                showDownload(results.join('\n'));
                status.innerHTML = `âœ… ØªØ¹Ø¯Ø§Ø¯ ${results.length} Ú©Ø§Ù†ÙÛŒÚ¯ WebSocket Ø§ØµÙ„Ø§Ø­ Ø´Ø¯.`;
                status.className = "success";
                status.style.display = "block";
            } else {
                alert("Ù‡ÛŒÚ† Ú©Ø§Ù†ÙÛŒÚ¯ WebSocket Ø¯Ø± ÙØ§ÛŒÙ„ Ù¾ÛŒØ¯Ø§ Ù†Ø´Ø¯!");
            }
        };
        reader.readAsText(fileInput.files[0]);
    }

    function showDownload(data) {
        const blob = new Blob([data], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const dlContainer = document.getElementById('dlContainer');
        dlContainer.innerHTML = `<a href="${url}" download="Clean_Configs.txt" class="download-btn">ğŸ“¥ Ø¯Ø§Ù†Ù„ÙˆØ¯ ÙØ§ÛŒÙ„ (Clean_Configs.txt)</a>`;
    }
</script>

</body>
</html>
